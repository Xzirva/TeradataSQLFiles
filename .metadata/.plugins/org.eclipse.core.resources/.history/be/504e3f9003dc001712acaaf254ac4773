-- Cleaning description: Removing urls
update prdwa17_staging.videos_descriptions
set description = regexp_replace(description, '(http.+?|www.+?) ', ' ');

-- Cleaning title: Removing urls
update prdwa17_staging.videos_titles 
set title = regexp_replace(title, '(http.+?|www.+?) ', ' ');
update prdwa17_staging.videos_descriptions set description = regexp_replace(description, (select * from prdwa17_staging.unwanted_chars order by 1 desc limit 1), '')
where description LIKE '%' || (select * from prdwa17_staging.unwanted_chars order by 1 desc limit 1) || '%';

truncate prdwa17_staging.parsed_descriptions;
insert into prdwa17_stating.parsed_descriptions
select id, description, TRIM(token) as term, length(TRIM(token)) ,frequency, position from text_parser(on 
(select * from prdwa17_staging.videos_descriptions)
	text_column('description')
	case_insensitive('true')
	stemming('true')
	Punctuation ('\[\]\".,?:;!\|\%\&\#\+\-\=\$\@\(\)\'\]')	
	list_positions('false')
	remove_stop_words('true')
	accumulate('id', 'description')
	)
order by term;
--'
create table prdwa17_staging.tf_idf_in DISTRIBUTE BY HASH(term) as
select id, term from prdwa17_staging.parsed_descriptions;