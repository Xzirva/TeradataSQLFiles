--SELECT "screenshot", "id", "channelid", "title", "description", "publishedat", "viewcount", "commentcount", "likecount", "dislikecount", "favoritecount", "categoryid", "topiccategory_1", "topiccategory_2", "topiccategory_3", "fetchedat" FROM "prdwa17_staging"."videos";
create table prdwa17_staging.video_title_tokens(id VARCHAR(100) PRIMARY KEY, 
token VARCHAR(255));

--insert into prdwa17_staging.video_title_tokens
/*CREATE VIEW prdwa17_staging.title_view AS
SELECT id || '-§-' || title as r_id, * FROM prdwa17_staging.videos;
select * from prdwa17_staging.title_view;*/

--select id, title, LTRIM(ngram, ''), n frequency from (

	CREATE TABLE prdwa17_staging.tf_idf_in_titles DISTRIBUTE BY HASH(token) AS
	SELECT id, title, ngram as token, n as token_count, frequency FROM nGram (
	ON (select * from prdwa17_staging.videos)
	Text_Column ('title')
	Delimiter ('\\s+')
	Grams ('1')
	Overlapping ('false')
	Case_insensitive ('true')
	Punctuation ('\[".,?:;!\|]')
	--Reset ('\[.,?\!\]')
	Accumulate ('id', 'title'))
	order by id, title;
	--) AS res
;

--select token, count(*) from prdwa17_staging.tf_idf_in_titles group by token;
create table prdwa17_staging.tf_idf_in_descriptions DISTRIBUTE BY HASH(token);
	SELECT id, description, ngram as token, n as token_count, frequency FROM nGram (
	ON (select * from prdwa17_staging.videos limit 100)
	Text_Column ('description')
	Delimiter ('(((\\s+)|\#)|\/)')
	Grams ('1')
	Overlapping ('false')
	Case_insensitive ('true')
	Punctuation ('\[".,?:;!\|]')
	--Reset ('\[.,?\!\]')
	Accumulate ('id', 'description'))
	order by id, description;
	--) AS res
;

--create table prdwa17_staging.tfidf_videos_titles(id VARCHAR(100), title VARCHAR(255), word VARCHAR(255));
-----------------------------------------------------------------------------------------
